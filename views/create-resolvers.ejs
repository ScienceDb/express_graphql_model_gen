/*
    Resolvers for basic CRUD operations
*/

const{<%-  nameLc  -%>} = require('../models/<%- nameLc -%>');
const searchArg = require('../utils/search-argument');

module.exports = {
  <%- namePl -%>: function(_,context){
    return <%- nameLc -%>.findAll();
  },

  search<%- name -%>: function({input}){
    let arg = new searchArg(input);
    let arg_sequelize = arg.toSequelize();
    return <%- nameLc -%>.findAll({where: arg_sequelize});
  },

  readOne<%- name -%>: function({id}){
    return <%- nameLc -%>.findOne({where: {id: id}, include:[{all: true}]});
  },

  add<%- name -%>: function({<%for(var key in attributes){-%><%=key-%>,<%}-%>}, context){
    return <%- nameLc -%>.create({<%for(var key in attributes){-%><%=key-%>,<%}-%>})
    .then( <%- nameLc -%> =>{
      return <%- nameLc -%>;
    });
  },

  delete<%- name -%>: function({id}, context){
    return <%- nameLc -%>
      .findById(id)
      .then( <%- nameLc -%> =>{
        return <%- nameLc -%>
          .destroy()
          .then(()=>{return 'Item succesfully deleted';});
        });
  },

  update<%- name -%>: function({
    id,<%for(var key in attributes){-%><%=key-%>,<%}-%>},context){
    return <%- nameLc -%>
      .findById(id)
      .then( <%- nameLc -%> => {
          return <%- nameLc -%>.update({<%for(var key in attributes){-%>
            <%=key-%>: <%=key-%> || <%- nameLc-%>.<%=key-%>,
            <%}-%>})
        });


  }
}
