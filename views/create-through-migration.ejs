'use strict';

/**
 * @module - Migrations to creates a through table correspondant to manay-to-many association between two sequelize models.
 */
module.exports = {

  /**
   * up - Creates a table in the database for storing a many-to-many association
   *
   * @param  {object} queryInterface Used to modify the table in the database.
   * @param  {object} Sequelize      Sequelize instance with data types included
   * @return {promise}                Resolved if the table was succesfully created.
   */
  up: function(queryInterface, Sequelize){
    return queryInterface.createTable('<%-keysIn-%>', {

      createdAt: {
        type: Sequelize.DATE
      },

      updatedAt: {
        type: Sequelize.DATE
      },

      <%- sourceKey-%>:{
        type: Sequelize.INTEGER,
        onDelete: 'CASCADE',
        references:{
          model: '<%-source-%>',
          key: 'id'
        }
      },

      <%- targetKey-%>:{
        type: Sequelize.INTEGER,
        onDelete: 'CASCADE',
        references:{
          model: '<%-target_lc_pl-%>',
          key: 'id'
        }
      }
    }).then(()=>{
      return queryInterface.addIndex('<%-keysIn-%>', ['<%- sourceKey-%>']);
    }).then(()=>{
      return queryInterface.addIndex('<%-keysIn-%>', ['<%- targetKey-%>']);
    });
  },

  /**
   * down - Deletes a table in the database for storing a many-to-many association
   *
   * @param  {object} queryInterface Used to modify the table in the database.
   * @param  {object} Sequelize      Sequelize instance with data types included
   * @return {promise}                Resolved if the table was succesfully deleted.
   */
  down: function(queryInterface, Sequelize){
    return queryInterface.dropTable('<%-keysIn-%>');
  }

};
